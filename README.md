# Survey API

## 1. 技术栈

- SpringBoot

## 2. 功能分析

### 2.1 用户角色

本系统涉及到的一共三种角色，但是实际情况只设计两种，且暂时只考虑调查者角色。

- 调查者（role 0）：具有调查意向的人，同时也是问卷的设计者、分析者，负责设计问卷，查看问卷调查局结果，并对问卷结果进行分析总结。
- 管理员（role 1）：拥有系统的全部权限，可以查看所有已注册的调查者以及其创建的调查问卷。
- 调查对象：被调查的对象，不需要登录系统，使用问卷链接即可填写信息。

### 2.2 功能分析

> 未标明权限的表示全部开放。

#### 2.2.1 调查者

1. 注册登录

   - 登录
   - 注册

2. 问卷相关

   - 创建问卷（注册用户 0，管理员 1）
   - 编辑问卷（注册用户 0，管理员 1）
     - 编辑标题 title 和描述 description
     - 新增问题

   - 发布问卷（注册用户 0，管理员 1）
   - 撤销问卷（注册用户 0，管理员 1）
   - 删除问卷（注册用户 0，管理员 1）
   - 分析问卷，即获取问卷的答案（注册用户 0）

3. 问题相关

   - 新增问题（注册用户 0）
     - 单选题
     - 多选题
     - 填空题
     - 评分题（实质为填空题）
   - 删除问题（注册用户 0）
   - 编辑问题（注册用户 0）
     - 填空题：
       - 编辑问题 title
       - 编辑是否必答
     - 选择题：
       - 编辑问题 title
       - 编辑是否必答

4. 选项相关

   仅适用于单选和多选。

   - 新增选项（注册用户 0）
   - 删除选项（注册用户 0）
   - 编辑选项（注册用户 0）

5. 创建者（普通用户，需要创建一份问卷的注册用户）

   - 获取其创建的所有问卷
     - status 为 0，未发布，只有 注册用户 0，管理员 1 有权限
     - status 为 1，已发布，权限全部开放
   - 发布问卷后，生成一个 link-survey_id 表
     - link：12位随机数字字母的表，例如 `wFvR7ix.aspx`，访问 http://localhost:3333/sv/wFvR7ix.aspx 即可开始填写问卷。
     - 用户点击公开发布问卷，则插入此表一条字段，link 由后端生成。
   - 获取某问卷对应的选项（权限取决于其问卷的 status）
     - 包含 sort 字段，0，1，2，3 依次表示选项的顺序
   - 获取某问卷对应的答案，用于图表分析（注册用户 0）
     - 包含 sort 字段，来自选项表

6. 管理员

   - 获取所有用户
  - 获取所有问卷

## 4. 数据库设计

> 以下数据供参考，以 sql 文件为准，可调整。

参考链接：[(12条消息) 一份简单的调查问卷数据库设计_lianhy的博客-CSDN博客](https://blog.csdn.net/Snowprincev/article/details/103183819)

### 4.1 用户表

- user

| 名          | 类型     | 非 null | 主键 | 备注                      |
| ----------- | -------- | :-------: | ---- | ------------------------- |
| id          | bigint   | ✅       | 🔑    | 主键 ID                   |
| username    | varchar  | ✅       |      | 用户名                    |
| nickname    | varchar  |         |      | 昵称，可重复        |
| password    | varchar  | ✅       |      | 密码                      |
| phone       | varchar  |         |      | 联系电话                  |
| email |  | | | 电子邮箱 |
| gender      | int      | 0 |      | 性别，0 男 1 女           |
| avatar      | varchar  |         |      | 图片，存储的是地址        |
| role    | int      | 0 |      | 角色，0 普通用户 1 管理员 |
| create_time | datetime | ✅       |      | 账号创建时间              |
| update_time | datetime | ✅       |      | 账号更新时间              |
| del_flag    | int      | 0 |      | 逻辑删除，0 未删除 1 删除 |

### 4.2 问卷表

survey(questionnaire)

> 调查者创建的问卷表，每创建一份问卷，就添加一条记录。

| 名         | 类型    | 非 null | 主键      | 备注 |
| ---------- | ------- | :-------: | --------- | ---- |
| id         | int     | ✅ | 🔑    | 主键 ID |
| user_id | int | ✅ |  | 创建者 ID |
| title | varchar | ✅ |   | 标题 |
| status | int | ✅ | | 是否发布，0 未发布，1 发布 |
| description | varchar |         |           | 描述 |
| create_time | datetime | ✅ |      | 创建时间              |
| update_time | datetime | ✅ |      | 更新时间              |
| expire_time | datetime | ✅ | | 截止时间 |
| deleted | int | 0 | | 逻辑删除，0未删除 1删除 |

### 4.3 问题表

question

> 每一个问卷中的问题记录字段，每新增一个问题，就添加一条记录。
>
> 初步计划是从后端获取问卷类型，前端来生成具体的问题，问题类型还可以扩充。

| 名         | 类型    | 非 null | 主键      | 备注 |
| ---------- | ------- | :-------: | --------- | ---- |
| id         | int     | ✅ | 🔑    | 主键 ID |
| survey_id | int | ✅ |  | 问卷 ID |
| title | varchar | ✅ |   | 问题标题/内容 |
| type | int | ✅ | | 问题类型，1 单选 2 多选 3 填空 4 评分 |
| required | int |  | | 是否必答，0 否 1 是 |
| create_time | datetime | ✅ |      | 创建时间              |
| update_time | datetime | ✅ |      | 更新时间              |

### 4.4 选项表

option

一个问题的所有选项，可能为选择题：单选、多选，也可能为填空题

若为填写类型的题（填空题，用户输入文本），则不插入选项表。

| 名         | 类型    | 非 null | 主键      | 备注 |
| ---------- | ------- | :-------: | --------- | ---- |
| id         | int     | ✅ | 🔑    | 主键 ID |
| survey_id | int | ✅ |  | 问卷 ID |
| question_id | varchar | ✅ |   | 问题 ID |
| content | varchar |  | | 选项内容 |
| sort | int | ✅ | | 问题的选项的顺序，0，1，2，3，... |

### 4.5 答案表

answer

| 名          | 类型    | 非 null | 主键 | 备注      |
| ----------- | ------- | :-----: | ---- | --------- |
| id          | int     |    ✅    | 🔑    | 主键 ID   |
| survey_id   | int     |    ✅    |      | 问卷表 ID |
| question_id | int     |    ✅    |      | 问题表 ID |
| option_id   | int     |    ✅    |      | 选项表 ID |
| content     | varchar |    ✅    |      | 答案内容  |

答案内容 content 是由前端传来的字符串。

### 4.6 链接表

link_survey


| 名        | 类型    | 非 null | 主键 | 备注                           |
| --------- | ------- | :-----: | ---- | ------------------------------ |
| id        | int     |    ✅    | 🔑    | 主键 ID                        |
| link      | varchar |    ✅    |      | 链接，12位随机字符串，不可重复 |
| survey_id | varchar |    ✅    |      | 对应问卷 ID                    |
| status    | int     |    ✅    |      | 是否公开发布，0 否，1 是       |

## 5. 前端问卷设计

### 5.1 问题类型

- 填空题
  - 用户输入文本
- 选择题
  - 单选题
  - 评分题（本质也是选择题）
  - 多选题
  - 下拉框选择

### 5.2 数据统计

只统计选择题，并使用柱状图、条形图等不同类型图标表示，数据从后端答案表获取。

